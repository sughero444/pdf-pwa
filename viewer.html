<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Viewer</title>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background: black;
        display: flex;
        flex-direction: column;
    }

    #topbar {
        width: 100%;
        padding: 10px;
        background: #111;
        color: white;
        display: flex;
        justify-content: center;
        gap: 20px;
        z-index: 9999;
    }

    #viewer-container {
        flex: 1;
        display: flex;
        overflow: hidden;
        position: relative;
        background: black;
    }

    .page {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        transition: transform 12s linear; /* ANIMAZIONE COSTANTE */
    }

    .instant {
        transition: none !important; /* niente animazione verso sinistra */
    }

    canvas {
        display: block;
    }
</style>
</head>

<body>

<div id="topbar">
    <button id="prevBtn">⬅️</button>
    <button id="nextBtn">➡️</button>
    <input type="file" id="pdfInput" accept="application/pdf">
</div>

<div id="viewer-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.min.js"></script>

<script>
let pdfDoc = null;
let currentPage = 1;
let rendering = false;

const viewer = document.getElementById("viewer-container");
const input = document.getElementById("pdfInput");
const nextBtn = document.getElementById("nextBtn");
const prevBtn = document.getElementById("prevBtn");

/*  QUALITY SCALE DINAMICO
    - minimo 2 (smartphone)
    - massimo 5 (4K)
*/
const QUALITY_SCALE = Math.min(5, Math.max(2, window.devicePixelRatio * 2));

function clearPages() {
    viewer.innerHTML = "";
}

async function renderPage(pageNum, offset = 0, animate = true) {
    if (pageNum < 1 || pageNum > pdfDoc.numPages) return;

    const page = await pdfDoc.getPage(pageNum);

    // Viewport base
    const viewport = page.getViewport({ scale: 1 });

    // Risoluzione target molto alta
    const targetWidth = viewport.width * QUALITY_SCALE;
    const targetHeight = viewport.height * QUALITY_SCALE;

    const ratio = viewport.width / viewport.height;

    let finalWidth = targetWidth;
    let finalHeight = finalWidth / ratio;

    if (finalHeight > targetHeight) {
        finalHeight = targetHeight;
        finalWidth = finalHeight * ratio;
    }

    const scale = finalWidth / viewport.width;
    const scaledViewport = page.getViewport({ scale });

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    // Canvas retina-friendly
    canvas.width = scaledViewport.width;
    canvas.height = scaledViewport.height;
    canvas.style.width = scaledViewport.width / window.devicePixelRatio + "px";
    canvas.style.height = scaledViewport.height / window.devicePixelRatio + "px";

    const wrapper = document.createElement("div");
    wrapper.className = "page";
    if (!animate) wrapper.classList.add("instant");

    wrapper.style.left = offset + "px";

    wrapper.appendChild(canvas);
    viewer.appendChild(wrapper);

    const renderContext = {
        canvasContext: ctx,
        viewport: scaledViewport
    };

    await page.render(renderContext).promise;

    return wrapper;
}

async function renderSpread(pageNum, direction = 0, animate = true) {
    clearPages();

    const pageWidth = viewer.clientWidth;
    const pageHeight = viewer.clientHeight;

    const centerX = pageWidth / 2;

    // Pagina sinistra
    const leftPage = await renderPage(pageNum, centerX - (pageWidth * 0.52), animate);

    // Pagina destra (se esiste)
    if (pageNum + 1 <= pdfDoc.numPages) {
        awai
